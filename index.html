<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vue todo</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>
<div id="app">
	<form v-on:submit.prevent="submitHandler">
		<label for="name">Добавить задачу</label>
		<br>
		<input id="name" type="text" v-model="todo">
		<button type="submit">Добавить</button>
	</form>
	<ul class="todo-container">
		<li v-for="todo in todos" :key="todo.id" >
			<template v-if="!todo.editable">
				<span >{{ todo.title }}</span>
				<button type="button" v-on:click="removeTodoHandler(todo.id)">Удалить</button>
				<button type="button" v-on:click="editTodoHandler(todo.id)">Редактировать</button>
			</template>
			<template v-else>
				<input type="text" v-model="tempValue">
				<button type="button" v-on:click="saveNewValueHandler(todo.id)">Сохранить</button>
				<button type="button" v-on:click="cancelSaveHandler(todo.id)">Отменить</button>
			</template>
		</li>
		<div v-if="!todos.length">Пока у вас нет ни одной задачи</div>
	</ul>
</div>

<script>

  const { createApp, toRaw } = Vue

  createApp({
    data() {
			return {
				tempValue: null,
				todo: null,
				todos: []
			}
		},
		methods: {
			submitHandler() {
				if(!this.todo) {
					return;
				}
				this.todos.push({
					id: `id-${this.todo}-${this.todos.length}`,
					title: this.todo,
					editable: false
				});
				this.todo = null;
			},
			removeTodoHandler(id) {
				this.todos = this.todos.filter((todo) => todo.id !== id);
			},
			editTodoHandler(id) {
				this.todo = this.todos.filter((todo) => todo.id === id)[0];
				this.todo.editable = true;
				this.tempValue = this.todo.title;
			},
			changeHandler(e) {
				this.tempValue = e.target.value;
			},
			saveNewValueHandler(id) {
				this.todo = this.todos.filter((todo) => todo.id === id)[0];

				this.todo.title = this.tempValue;
				this.todo.id = `id-${this.tempValue}-${this.todos.length}`
				this.todo.editable = false;

				this.todo = null;
				this.tempValue = null;
			},
			cancelSaveHandler(id) {
				this.todo = this.todos.filter((todo) => todo.id === id)[0];

				this.todo.editable = false;

				this.todo = null;
				this.tempValue = null;
			}
		}
  }).mount('#app')
</script>
</body>
</html>